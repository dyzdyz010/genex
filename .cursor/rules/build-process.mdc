---
description: 
globs: 
alwaysApply: false
---
flowchart TD
    subgraph "配置加载"
        A1[读取配置文件] --> A2[载入环境变量]
        A2 --> A3[合并默认配置]
        A3 --> A4[验证配置有效性]
    end

    subgraph "插件加载"
        C1[扫描插件目录] --> C2[加载插件配置]
        C2 --> C3[排序并初始化插件]
    end
    
    subgraph "初始化"
        B1[读取主配置文件] --> B2[加载主题配置]
        B2 --> B3[验证项目结构]
        B3 --> B4[准备构建目录]
        B4 --> B5[初始化构建上下文]
    end

    subgraph "内容收集"
        D1[扫描内容目录] --> D2[解析内容元数据]
        D2 --> D3[建立内容模型]
        D3 --> D4[分类内容集合]
    end

    subgraph "内容处理与转换"
        F1[Markdown转HTML] --> F2[处理嵌入内容]
        F2 --> F3[代码高亮处理]
        F3 --> F4[图片优化处理]
    end

    subgraph "模板收集"
        H1[扫描模板目录] --> H2[解析模板标签]
        H2 --> H3[建立布局层次]
        H3 --> H4[注册布局链]
    end

    subgraph "数据整合"
        J1[整合全局数据] --> J2[合并内容数据]
        J2 --> J3[处理数据关系]
        J3 --> J4[建立内部链接]
    end

    subgraph "路由生成"
        L1[创建静态路由] --> L2[创建动态路由]
        L2 --> L3[处理参数映射]
        L3 --> L4[规范化URL路径]
    end

    subgraph "渲染页面"
        N1[应用模板] --> N2[注入数据]
        N2 --> N3[应用布局链]
        N3 --> N4[渲染组件]
        N4 --> N5[生成HTML]
    end

    subgraph "资源优化"
        P1[复制静态资源] --> P2[CSS处理]
        P2 --> P3[JS处理]
        P3 --> P4[图片优化]
    end

    subgraph "生成输出文件"
        R1[写入HTML文件] --> R2[生成站点地图]
        R2 --> R3[生成RSS/Atom]
        R3 --> R4[输出元数据]
    end

    A4 --> C1
    C3 -->|钩子: 初始化前处理| B1
    B5 -->|钩子: 构建开始| D1
    D4 -->|钩子: 内容前处理| F1
    F4 -->|钩子: 内容后处理| H1
    H4 -->|钩子: 模板处理| J1
    J4 -->|钩子: 数据准备完毕| L1
    L4 -->|钩子: 路由准备完毕| N1
    N5 -->|钩子: 渲染后处理| P1
    P4 -->|钩子: 最终输出前| R1
    R4 -->|钩子: 构建完成| END[完成构建]